

{TODO :
Событие несуществующего в конф. ТС/зоны/УД/... -> для него сгенерировать
номер=0, польз., зону и т .п.}
{TODO : 
ptc^.State:= ptc^.State and $03;
Неиспр. восст м.б.н. ptc^.State:= ptc^.State and $0B}


{TODO :
проверить 8202 103 при старте  проги в ситуации
1) неисправность  ШС
2) после рестарта БЦП}


{TODO : ptc м.б.= nil для всех событий ТС >> Exception}



{TODO : TCU-7 на 8 исправить заменив CU.State byte на Word}


{TODO :
в r8c разные параметры - одинаковые значения в секции [СУ]
Нужно в цикле большем чем 1000 пройтись по всем параметрам}




{TODO : Почему-то, возможны две ТД с одинаковым ID оборудования}




{TODO : При изменении номера ШС из БЦП номер ШС в драйвере не меняется}


{TODO  : ТС Create, 
ТС Edit, и др. события Delete при выключенном драйвере
Затем драйвер включают и вычитываются события по несуществующим СУ,ТС,Пользователям, ВЗ, УД ?
}



1. Самое приоритетное - Событие, которое выводит на верхний уровень драйвер !!!
2. Событие не должно откладываться для дальнейшей обработки (есть риск потерять его внутри программы) !!!
3. Не ПРОВЕРЯЙ ЛИШНИЙ РАЗ (не усложняй) !!!


1. Время постановки или снятия зоны 10-12с
2. Не всегда с вероятностью 20% ставятся или снимаются все ШС в зоне
3. После нескольких снятий с охраны (с помощью ПУО-02) различных зон (содержащих по 4 минимум ШС) ПУО-02 перестает реагировать на команды пользователя. 
	Чтобы он не вводил (пароль, неверный пароль) ПУО-02 отвечает всегда "Занят". Если ПУО-02 перекинуть на другую линию БЦП, ситуация аналогична. 


     mDeleteCUs (9264)
     mDeleteZones (9266)
     mDeleteGRs (9287)
     mDeleteUsers (9272)
     mDeletePrava (9270)
     mDeleteTimeIntervals
     mDeleteRNs (9345)
     mDeleteRPs (9346)
     mDeleteHDs (9347)


1. События создания (зон, ТС, Гр, ВЗ, УД, Прав, Польз., Скрипт)  учитываются:
	- только по командам ПО
	- только когда, объект в событии найден
   иначе игнорируются.

1а) Например, когда-то создалось и удалилось ТС. При старте драйвера ловится это создание.
    Если этот ТС НЕ НАЙДЕН в считанной конфигурации, то событие фиксируется с id>1000.
    Конечно можно отрпавить запрос конфигурации этого ТС, но после перепрограмирования БЦП таких запросов будет множество.
1б) Если ТС создается вручную во время работы драйвера, то событие фиксируется с id>1000, как в п.1а

1в) Если в событии ТС не найдено, то можно запросить конф. и состояние, но лучше 
	- если это создание и до старта драйвера, то пропустить и перегрузить через 3 мин, (тогда это событие не будет передано на ВУ)
	- если это другое событие, то только пропустить

    чтобы все события старые и не верные прошли.
    if pcu=nil then
       case rbuf[16*i+9]+256*rbuf[16*i+10] of
         $1..$999,
         $2001..$2002,
         $2501..$250D,
         $320b,
         $8381,
         $8481..$8482:
           continue;
         $8480:
         begin
           //если время больше старта,
           //то отсроченная на 3 мин. перегрузка,
           //т.к. СУ могли вручную добавить
           continue;
         end;
       end;

2. БИС конфигурация
3. После прошивки БЦП r8c переименовывается

                                                         

После прошивки БЦП 
	вычитываются состояния
	изменяется время старта драйвера на текущее, чтобы события прошивки не вызывали запрос конфигурации и состояний
	но лучше перегрузить (завершение работы после программирования)
 
	
{
Изм.1.1 ВЗ: В событиях от БЦП  $8980(Создана ВЗ), $8981(Редактирована ВЗ), $8982(Удалена ВЗ) убраны строки для запроса ВИ по данной ВЗ
          //
          for j:=rub.TI.Count downto 1 do
          begin
            pti:=rub.TI.Items[j-1];
            if pti^.ParentTimeZone=rbuf[16*i+5] then
            begin
              rub.TI.Remove(pti);
              Dispose(pti);
            end;
          end;
          //
          rub.comd:= 34;
          rub.Temp2Index:= rbuf[16*i+5];
          rub.TempIndex:= $FFFF;

Изм.1.2 ВЗ: В событии от БЦП где отправляется R8_TZ_ALL_DELETE убраны строки для запроса ВИ по данной ВЗ
          //
          for j:=rub.TI.Count downto 1 do
          begin
            pti:=rub.TI.Items[j-1];
            rub.TI.Remove(pti);
            Dispose(pti);
          end;

Изм.2.1 УД. В событиях от БЦП  $8A80(Создан УД), $8A81(Редактирован УД) убраны 3 строки
инициализации автоматического запроса конфигурации УД
          //
          rub.comd:=36;
          rub.Temp2Index:=rbuf[16*i+5];
          rub.TempIndex:=$FFFF;
}
